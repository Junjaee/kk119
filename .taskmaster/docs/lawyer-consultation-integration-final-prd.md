# PRD: 변호사 상담 게시판 제거 및 신고 시스템 통합

## 1. 프로젝트 개요

### 1.1 목적
교권119 시스템에서 독립적인 변호사 상담 게시판을 완전히 제거하고, 신고 접수 시스템 내에서 변호사 상담이 이루어지도록 통합하여 사용자 경험을 개선하고 시스템을 단순화한다.

### 1.2 배경
- 변호사 상담 기능의 활용도가 낮음
- 신고 접수와 변호사 상담이 분리되어 있어 사용자가 혼란을 겪음
- 신고 접수 후 변호사 상담이 필요한 경우가 많아 자연스러운 연결이 필요
- 시스템 복잡성 감소 및 유지보수성 향상 필요
- 핵심 기능(신고 접수, 커뮤니티, 교권 자료실)에 집중하기 위함

### 1.3 범위
- **제거**: 독립적인 변호사 상담 게시판 (/consult 경로) 완전 삭제
- **통합**: 신고 접수 시스템 내 변호사 상담 기능 구현
- **개선**: 신고 처리 프로세스에 변호사 상담 단계 추가
- **UI/UX**: 통합된 인터페이스 설계 및 구현
- **데이터베이스**: 변호사 상담 관련 테이블 정리 및 새로운 스키마 구현
- **네비게이션**: 메뉴 구조에서 변호사 상담 항목 제거

## 2. 시스템 구조 변경

### 2.1 현재 시스템 구조
```
[신고 접수] → [검토] → [상담진행] → [해결완료]
     ↓
[변호사 상담 게시판] (독립적)
```

### 2.2 새로운 시스템 구조
```
[신고 접수] → [검토] → [변호사 상담 배정] → [상담진행] → [해결완료]
                              ↓
                      [변호사 응답 & 조치]
```

## 3. 제거 대상 식별

### 3.1 사용자 인터페이스 (UI)
- **대시보드**: 메인 페이지의 "변호사 상담" 섹션 (app/page.tsx)
- **네비게이션**: 사이드바의 "변호사 상담" 메뉴 항목
- **페이지**: `/consult` 경로 및 관련 하위 페이지
- **컴포넌트**: 변호사 상담 관련 React 컴포넌트들

### 3.2 백엔드 API
- `/api/consult/*` - 변호사 상담 관련 API 엔드포인트
- 변호사 상담 데이터 처리 로직
- 변호사 상담 관련 미들웨어 및 유틸리티 함수

### 3.3 데이터베이스
- `consultations` 테이블 (존재하는 경우)
- 변호사 상담 관련 외래키 참조
- 변호사 상담 관련 더미 데이터

### 3.4 라우팅 및 권한
- `/consult` 경로 정의
- `/lawyer` 경로 정의
- 변호사 상담 관련 역할 기반 접근 제어
- 미들웨어의 변호사 상담 경로 보호 설정

## 4. 기능 요구사항

### 4.1 신고 처리 프로세스 개선

#### 4.1.1 신고 상태 확장
기존 상태:
- `received` (접수완료)
- `reviewing` (검토중)
- `consulting` (상담진행)
- `completed` (해결완료)

추가 상태:
- `lawyer_assigned` (변호사 배정됨)
- `lawyer_consulting` (변호사 상담중)
- `lawyer_responded` (변호사 응답완료)

#### 4.1.2 변호사 배정 시스템
- 관리자가 신고 내역을 검토 후 변호사 상담 필요 여부 판단
- 변호사 상담이 필요한 경우 적절한 변호사에게 배정
- 변호사에게 알림 발송 (이메일 또는 시스템 내 알림)
- 변호사별 업무량 및 전문 분야 고려한 배정 도구

### 4.2 변호사 대시보드 기능

#### 4.2.1 배정된 신고 목록
- 본인에게 배정된 신고 내역 조회
- 신고 상세 정보 및 첨부 파일 확인
- 상담 진행 상태 관리
- 우선순위 및 긴급도별 정렬

#### 4.2.2 상담 응답 시스템
- 신고에 대한 법적 조언 작성
- 권장 조치사항 제시
- 필요시 추가 자료 요청
- 상담 완료 처리
- 템플릿 기반 응답 지원

### 4.3 신고자 인터페이스 개선

#### 4.3.1 신고 상세 페이지 확장
- 변호사 배정 정보 표시
- 변호사 상담 진행 상황 실시간 업데이트
- 변호사 응답 내용 확인
- 추가 질문이나 자료 제출 기능
- 상담 히스토리 조회

#### 4.3.2 알림 시스템
- 변호사 배정 시 알림
- 변호사 응답 완료 시 알림
- 추가 자료 요청 시 알림
- 푸시 알림 및 이메일 지원

## 5. 구현 계획

### 5.1 Phase 1: UI 컴포넌트 제거
**우선순위: High (1주차)**

#### 5.1.1 대시보드 정리
- 메인 페이지(app/page.tsx)에서 변호사 상담 섹션 삭제
  - recentConsults 모크 데이터 제거 (lines 65-80)
  - 변호사 상담 섹션 컴포넌트 제거 (lines 372-416)
  - 3-column 그리드를 2-column으로 변경 (line 325)
  - MessageSquare import 제거

#### 5.1.2 네비게이션 업데이트
- 사이드바(components/layout/sidebar.tsx)에서 변호사 상담 메뉴 항목 제거
  - Teacher role의 /consult 메뉴 제거 (lines 69-75)
  - Lawyer role의 /lawyer/consults 메뉴 제거 (lines 100-106)
  - Admin role의 변호사 관리 메뉴 제거 (lines 145-151)
  - Super_admin role의 변호사 관리 메뉴 제거 (lines 198-204)

#### 5.1.3 페이지 삭제
- `/app/consult/` 디렉토리 전체 삭제
- `/app/lawyer/` 디렉토리 전체 삭제
- `/app/lawyer-consult/` 디렉토리 삭제
- 관련 layout.tsx, page.tsx 파일 제거

### 5.2 Phase 2: 백엔드 및 미들웨어 정리
**우선순위: High (1주차)**

#### 5.2.1 미들웨어 업데이트 (middleware.ts)
- rolePaths.lawyer 배열에서 /consult 제거 (line 36)
- protectedPaths 배열에서 /consult 제거 (line 55)
- lawyer role 접근 제어 로직 정리 (lines 129-132)
- lawyer 사용자 리다이렉트 경로 업데이트 (line 148)

#### 5.2.2 API 엔드포인트 삭제
- `/app/api/consult/` 디렉토리 삭제
- 변호사 상담 관련 서버 로직 제거

#### 5.2.3 TypeScript 타입 정의 정리 (lib/types/index.ts)
- 'lawyer' UserRole 유지 (통합 시스템에서 필요)
- 변호사 상담 전용 타입 제거
- 신고 시스템 타입 확장

### 5.3 Phase 3: 데이터베이스 스키마 확장
**우선순위: High (2주차)**

#### 5.3.1 기존 테이블 정리
- consultations 테이블 확인 및 데이터 백업
- 변호사 상담 관련 더미 데이터 제거

#### 5.3.2 신고 테이블 확장 (reports)
```sql
ALTER TABLE reports ADD COLUMN lawyer_id INTEGER;
ALTER TABLE reports ADD COLUMN lawyer_assigned_at TIMESTAMP;
ALTER TABLE reports ADD COLUMN lawyer_consultation_started_at TIMESTAMP;
ALTER TABLE reports ADD COLUMN lawyer_response_at TIMESTAMP;
ALTER TABLE reports ADD COLUMN consultation_priority VARCHAR(20) DEFAULT 'normal';
```

#### 5.3.3 변호사 상담 응답 테이블 생성
```sql
CREATE TABLE lawyer_consultations (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  report_id INTEGER NOT NULL,
  lawyer_id INTEGER NOT NULL,
  consultation_content TEXT,
  recommended_actions TEXT,
  legal_basis TEXT,
  additional_notes TEXT,
  status VARCHAR(50) DEFAULT 'assigned',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (report_id) REFERENCES reports(id),
  FOREIGN KEY (lawyer_id) REFERENCES users(id)
);

CREATE INDEX idx_lawyer_consultations_report ON lawyer_consultations(report_id);
CREATE INDEX idx_lawyer_consultations_lawyer ON lawyer_consultations(lawyer_id);
```

### 5.4 Phase 4: 백엔드 API 개발
**우선순위: Medium (3-4주차)**

#### 5.4.1 신고 관리 API 확장
- `POST /api/reports/:id/assign-lawyer` - 변호사 배정
- `GET /api/reports/:id/consultation` - 변호사 상담 정보 조회
- `PUT /api/reports/:id/consultation` - 변호사 상담 응답 업데이트
- `POST /api/reports/:id/consultation/request-info` - 추가 정보 요청

#### 5.4.2 변호사 전용 API
- `GET /api/lawyer/assigned-reports` - 배정된 신고 목록
- `POST /api/lawyer/consultations` - 상담 응답 작성
- `PUT /api/lawyer/consultations/:id` - 상담 응답 수정
- `GET /api/lawyer/templates` - 상담 응답 템플릿 조회

#### 5.4.3 알림 API
- `POST /api/notifications/lawyer-assignment` - 변호사 배정 알림
- `POST /api/notifications/consultation-complete` - 상담 완료 알림

### 5.5 Phase 5: 프론트엔드 통합 개발
**우선순위: Medium (5-6주차)**

#### 5.5.1 관리자 인터페이스
- 신고 상세 페이지에 변호사 배정 기능 추가
- 변호사 목록 및 전문 분야별 필터링
- 배정 히스토리 및 통계 대시보드
- 변호사 업무량 시각화

#### 5.5.2 변호사 대시보드
- 배정된 신고 목록 페이지
- 신고 상세 조회 및 상담 응답 작성 인터페이스
- 상담 진행 상황 관리 도구
- 템플릿 관리 기능

#### 5.5.3 신고자 인터페이스
- 신고 상세 페이지에 변호사 상담 섹션 추가
- 변호사 정보 및 상담 진행 상황 표시
- 변호사 응답 내용 표시 및 피드백 기능
- 추가 질문 및 자료 제출 인터페이스

### 5.6 Phase 6: 테스트 및 최적화
**우선순위: Medium (7주차)**

#### 5.6.1 기능 테스트
- 변호사 상담 관련 모든 링크가 제거되었는지 확인
- 신고 시스템 내 변호사 상담 통합 기능 테스트
- 알림 시스템 동작 확인
- 404 에러 없이 다른 페이지들이 정상 동작하는지 확인

#### 5.6.2 성능 테스트
- 페이지 로딩 속도 측정
- API 응답 시간 측정
- 데이터베이스 쿼리 최적화

#### 5.6.3 사용자 수용 테스트
- 각 역할별 시나리오 테스트
- 피드백 수집 및 반영

## 6. 사용자 경험 (UX) 설계

### 6.1 신고자 관점

#### 6.1.1 신고 접수 후 흐름
1. 신고 접수 완료
2. 관리자 검토 (상태: reviewing)
3. 변호사 상담 필요 판단 시 변호사 배정 (상태: lawyer_assigned)
4. 변호사 상담 진행 알림 수신 (상태: lawyer_consulting)
5. 변호사 응답 완료 알림 수신 (상태: lawyer_responded)
6. 최종 해결 (상태: completed)

#### 6.1.2 신고 상세 페이지 UI
```
┌─────────────────────────────────────────────────────────┐
│ 신고 #123 - 학부모 민원 관련 건                          │
├─────────────────────────────────────────────────────────┤
│ 상태: 변호사 상담중 🟡                                   │
│ 접수일: 2024-08-27                                      │
│ 담당 변호사: 김변호사 ⭐⭐⭐⭐⭐                          │
├─────────────────────────────────────────────────────────┤
│ 📋 신고 내용                                           │
│ [신고 상세 내용]                                        │
├─────────────────────────────────────────────────────────┤
│ 💼 변호사 상담                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 상담 응답 (2024-08-28 15:30)                        │ │
│ │ [변호사의 법적 조언 내용]                            │ │
│ │                                                     │ │
│ │ 권장 조치사항:                                       │ │
│ │ - 조치 1                                           │ │
│ │ - 조치 2                                           │ │
│ └─────────────────────────────────────────────────────┘ │
│ [추가 질문하기] [자료 제출하기]                          │
└─────────────────────────────────────────────────────────┘
```

### 6.2 변호사 관점

#### 6.2.1 변호사 대시보드
```
┌─────────────────────────────────────────────────────────┐
│ 변호사 대시보드                                          │
├─────────────────────────────────────────────────────────┤
│ 📊 현황                                                │
│ • 배정된 신고: 5건                                      │
│ • 상담 대기: 2건                                        │
│ • 상담 완료: 3건                                        │
├─────────────────────────────────────────────────────────┤
│ 📋 배정된 신고 목록                                     │
│ ┌─────┬──────────────┬────────┬──────────────────┐      │
│ │ ID  │ 제목         │ 상태   │ 배정일           │      │
│ ├─────┼──────────────┼────────┼──────────────────┤      │
│ │ 123 │ 학부모 민원  │ 대기중 │ 2024-08-27      │      │
│ │ 124 │ 학생 폭언    │ 진행중 │ 2024-08-26      │      │
│ └─────┴──────────────┴────────┴──────────────────┘      │
└─────────────────────────────────────────────────────────┘
```

### 6.3 관리자 관점

#### 6.3.1 신고 관리 인터페이스
- 신고 목록에서 변호사 배정 필요 여부 쉽게 판단
- 변호사별 업무량 및 전문 분야 고려한 배정 도구
- 상담 진행 상황 모니터링 대시보드

## 7. 예상 효과

### 7.1 긍정적 효과
- **시스템 단순화**: 불필요한 기능 제거로 시스템 복잡도 감소
- **사용자 경험 개선**: 신고와 상담이 하나의 플로우로 연결되어 직관적
- **유지보수성 향상**: 관리해야 할 코드베이스 축소
- **업무 효율성 향상**: 신고 처리 과정에 변호사 상담이 자연스럽게 통합
- **성능 개선**: 사용되지 않는 코드 제거로 번들 크기 감소
- **추적 가능성**: 신고부터 해결까지 전체 과정을 하나의 케이스로 관리

### 7.2 개선된 워크플로우
```
신고자: 신고 접수 → 상황 모니터링 → 변호사 상담 확인 → 문제 해결
관리자: 신고 검토 → 변호사 배정 → 진행 상황 모니터링 → 최종 처리
변호사: 배정 알림 → 케이스 검토 → 법적 조언 제공 → 상담 완료
```

## 8. 리스크 및 완화 방안

### 8.1 리스크
- **데이터 손실**: 기존 변호사 상담 관련 중요한 데이터가 삭제될 수 있음
- **기능 의존성**: 다른 기능이 변호사 상담 기능에 의존할 가능성
- **변호사 업무 프로세스 변경**: 기존 상담 방식에서 신고 기반 상담으로 전환
- **사용자 혼란**: 기존 사용자가 기능 제거로 인해 혼란을 겪을 수 있음

### 8.2 완화 방안
- **데이터 백업**: 삭제 전 전체 데이터베이스 백업 실시
- **데이터 마이그레이션**: 기존 상담 데이터를 신고 시스템으로 마이그레이션
- **의존성 확인**: 코드 분석을 통해 다른 기능과의 의존성 사전 확인
- **단계적 전환**: 기존 시스템을 유지하면서 새로운 시스템 병행 운영 후 전환
- **사용자 안내**: 기능 제거 및 신규 프로세스에 대한 상세한 사용자 매뉴얼 제공
- **교육 및 지원**: 변호사 및 관리자 대상 새로운 시스템 교육

## 9. 성공 기준

### 9.1 기능적 성공 기준
- [ ] 메인 대시보드에서 변호사 상담 섹션이 완전히 제거됨
- [ ] 네비게이션에서 변호사 상담 메뉴가 제거됨
- [ ] `/consult` 및 `/lawyer` 경로 접근 시 적절한 404 처리됨
- [ ] 신고 시스템에 변호사 상담 기능이 완전히 통합됨
- [ ] 변호사 배정 및 상담 응답 기능이 정상 동작함
- [ ] 신고자가 변호사 상담 진행 상황을 실시간으로 확인 가능함
- [ ] 다른 모든 페이지가 정상 동작함

### 9.2 기술적 성공 기준
- [ ] 변호사 상담 관련 독립 코드가 모두 제거됨
- [ ] 빌드 에러나 TypeScript 에러가 없음
- [ ] 사용되지 않는 import나 의존성이 정리됨
- [ ] 데이터베이스 마이그레이션이 성공적으로 완료됨
- [ ] 새로운 API가 안정적으로 동작함
- [ ] 테스트가 모두 통과함

### 9.3 사용자 경험 성공 기준
- [ ] 레이아웃이 자연스럽게 조정됨
- [ ] 네비게이션이 직관적으로 유지됨
- [ ] 신고부터 변호사 상담까지의 프로세스가 직관적으로 연결됨
- [ ] 변호사가 배정된 신고를 효율적으로 관리할 수 있음
- [ ] 관리자가 변호사 배정 및 상담 진행을 쉽게 모니터링할 수 있음
- [ ] 페이지 로딩 속도가 개선되거나 유지됨
- [ ] 전반적인 사용자 경험이 개선됨

## 10. 타임라인

### Phase 1 (Week 1): 변호사 상담 게시판 제거
- UI 컴포넌트 제거 (대시보드, 네비게이션, 페이지)
- 미들웨어 및 라우팅 정리
- API 엔드포인트 삭제
- TypeScript 타입 정리

### Phase 2 (Week 2): 데이터베이스 준비
- 기존 데이터 백업
- 스키마 확장 및 마이그레이션
- 새로운 테이블 생성

### Phase 3-4 (Week 3-4): 백엔드 개발
- 신고 관리 API 확장
- 변호사 전용 API 개발
- 알림 시스템 구현

### Phase 5-6 (Week 5-6): 프론트엔드 개발
- 관리자 인터페이스 개발
- 변호사 대시보드 개발
- 신고자 인터페이스 개선

### Phase 7 (Week 7): 테스트 및 배포
- 기능 테스트
- 성능 최적화
- 사용자 수용 테스트
- 최종 배포

## 11. 결론

변호사 상담 게시판을 제거하고 신고 접수 시스템에 통합함으로써, 교권119 시스템은 더욱 직관적이고 효율적인 서비스로 발전할 수 있을 것입니다.

주요 이점:
1. **통합된 워크플로우**: 신고자는 하나의 일관된 프로세스를 통해 문제 해결
2. **효율적인 업무 처리**: 변호사는 더욱 체계적으로 상담 업무 수행
3. **통합 관리**: 관리자는 전체 케이스를 통합적으로 관리
4. **시스템 단순화**: 불필요한 복잡성 제거로 유지보수 용이

단계적 구현을 통해 기존 시스템의 안정성을 유지하면서 새로운 기능을 안전하게 도입하여, 궁극적으로 더 나은 사용자 경험과 시스템 효율성을 달성할 수 있을 것으로 기대됩니다.