# 교권119 데이터 마이그레이션 가이드

## 📋 개요

이 가이드는 교권119 시스템의 localStorage에서 Supabase 클라우드 데이터베이스로의 데이터 마이그레이션 프로세스를 설명합니다.

## 🎯 마이그레이션 목적

- **데이터 영속성**: 브라우저 데이터 삭제 시에도 데이터 보존
- **다중 기기 접근**: 어디서나 동일한 데이터 접근 가능
- **백업 및 복구**: 안전한 클라우드 백업
- **협업 기능**: 실시간 데이터 공유 및 동기화

## ⚠️ 마이그레이션 전 주의사항

### 📋 체크리스트
- [ ] **현재 데이터 확인**: localStorage에 저장된 신고 내역, 게시글, 댓글 수량 확인
- [ ] **인터넷 연결**: 안정적인 인터넷 연결 상태 확인
- [ ] **계정 상태**: 관리자 승인이 완료된 활성 계정 사용
- [ ] **백업**: 중요한 데이터는 사전에 별도 백업 권장

### 🚨 중요 알림
> **마이그레이션은 한 번만 수행**됩니다. 완료 후에는 되돌릴 수 없으므로 신중하게 진행하세요.

## 🛠️ 마이그레이션 절차

### 1단계: 마이그레이션 도구 접근

1. **관리자 계정으로 로그인**
   ```
   - 교권119 웹사이트 접속
   - 관리자 또는 승인된 교사 계정으로 로그인
   ```

2. **관리자 패널 이동**
   ```
   ├── 사이드바 → "관리자" 클릭
   └── 또는 URL: /admin
   ```

3. **마이그레이션 섹션 확인**
   ```
   관리자 대시보드 → "데이터베이스 마이그레이션" 카드
   ```

### 2단계: 마이그레이션 준비 상태 확인

#### 자동 준비 상태 검사 항목:
- ✅ **로컬 데이터 존재 여부**
- ✅ **사용자 계정 활성화 상태**
- ✅ **관리자 승인 여부**
- ✅ **네트워크 연결 상태**

#### 데이터 현황 확인:
| 데이터 유형 | 설명 | 예상 개수 |
|------------|------|-----------|
| 📄 신고 내역 | 교권 침해 신고서 | X개 |
| 💬 게시글 | 커뮤니티 포스트 | X개 |
| 💭 댓글 | 게시글 댓글 | X개 |

### 3단계: 마이그레이션 실행

#### 마이그레이션 마법사 사용

1. **"데이터 마이그레이션" 버튼 클릭**

2. **단계별 진행 과정:**

   ```
   1️⃣ 데이터 확인
   ├── localStorage 데이터 스캔
   ├── 데이터 무결성 검증
   └── 마이그레이션 가능 여부 판단

   2️⃣ 백업 생성
   ├── 기존 데이터 안전 백업
   ├── sessionStorage에 임시 백업 저장
   └── 복구 지점 생성

   3️⃣ 데이터 이전
   ├── Supabase 데이터베이스 연결
   ├── 신고 내역 이전
   ├── 커뮤니티 게시글 이전
   ├── 댓글 이전
   └── 데이터 검증

   4️⃣ 완료 확인
   ├── 이전 결과 검토
   ├── localStorage 정리
   └── 마이그레이션 완료 표시
   ```

3. **진행 상황 모니터링**
   - 실시간 진행률 표시
   - 단계별 완료 상태 확인
   - 오류 발생 시 즉시 알림

### 4단계: 마이그레이션 결과 확인

#### 성공 시 표시 내용:
```
✅ 마이그레이션 완료!

📊 이전 완료 통계:
├── 신고 내역: X개 성공, 0개 오류
├── 게시글: X개 성공, 0개 오류
└── 댓글: X개 성공, 0개 오류

🎉 총 X개 항목이 안전하게 이전되었습니다.
```

#### 실패 시 대응 방법:
1. **부분 실패**: 오류 로그 확인 및 재시도
2. **완전 실패**: 백업 데이터 복구 후 관리자 문의
3. **네트워크 오류**: 연결 상태 확인 후 재시도

## 🔧 마이그레이션 후 확인 사항

### 데이터 검증 체크리스트:
- [ ] **신고 내역**: 기존 신고서가 모두 보이는지 확인
- [ ] **커뮤니티**: 작성한 게시글과 댓글이 정상 표시되는지 확인
- [ ] **파일 첨부**: 첨부 파일명이 정확히 기록되었는지 확인
- [ ] **날짜 정보**: 작성일과 수정일이 올바른지 확인

### 기능 테스트:
- [ ] **새 신고 작성**: 정상적으로 생성되는지 확인
- [ ] **게시글 작성**: 커뮤니티 포스팅 가능한지 확인
- [ ] **댓글 작성**: 댓글 달기 기능 정상 작동 확인
- [ ] **다중 기기**: 다른 기기에서도 동일한 데이터 보이는지 확인

## 🆘 문제 해결

### 자주 발생하는 문제들

#### 1. "마이그레이션할 데이터가 없습니다"
**원인**: localStorage에 저장된 데이터가 없음
**해결**: 기존 데이터가 있는 브라우저/기기에서 마이그레이션 실행

#### 2. "계정이 승인되지 않았습니다"
**원인**: 관리자 승인 대기 상태
**해결**: 관리자에게 계정 승인 요청

#### 3. "네트워크 연결 오류"
**원인**: 인터넷 연결 불안정 또는 Supabase 서버 문제
**해결**:
- 네트워크 연결 상태 확인
- 잠시 후 재시도
- 문제 지속 시 관리자 문의

#### 4. "데이터 이전 중 오류"
**원인**: 서버 부하 또는 데이터 형식 문제
**해결**:
- 마이그레이션 마법사에서 "다시 시도" 버튼 클릭
- 백업 데이터 복구 옵션 사용
- 관리자 지원팀 문의

### 🔄 데이터 복구 방법

마이그레이션 실패 시 백업 데이터 복구:

1. **자동 복구**:
   ```
   마이그레이션 마법사 → "백업에서 복구" 버튼 클릭
   ```

2. **수동 복구**:
   ```javascript
   // 브라우저 개발자 도구 콘솔에서 실행
   const backup = sessionStorage.getItem('localStorage_backup');
   if (backup) {
       const data = JSON.parse(backup);
       localStorage.setItem('kk119_reports', JSON.stringify(data.reports));
       localStorage.setItem('kk119_community_posts', JSON.stringify(data.posts));
       localStorage.setItem('kk119_community_comments', JSON.stringify(data.comments));
       alert('백업 데이터 복구 완료');
   }
   ```

## 📞 지원 연락처

### 기술 지원:
- **이메일**: tech-support@kyokwon119.kr
- **전화**: 1588-1119
- **운영시간**: 평일 09:00-18:00

### 긴급 상황:
- **24시간 지원**: emergency@kyokwon119.kr
- **데이터 복구 전문팀**: data-recovery@kyokwon119.kr

## 📚 추가 자료

- [시스템 관리자 가이드](./ADMIN_GUIDE.md)
- [API 문서](./API_DOCUMENTATION.md)
- [자주 묻는 질문](./FAQ.md)
- [보안 정책](./SECURITY_POLICY.md)

---

> **💡 참고**: 이 가이드는 교권119 v2.0.0 버전을 기준으로 작성되었습니다. 시스템 업데이트 시 가이드도 함께 업데이트됩니다.

**최종 업데이트**: 2025년 9월 22일